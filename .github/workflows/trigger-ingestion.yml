name: Trigger Ingestor

on:
  schedule:
    - cron: "0 5 * * *"
  workflow_dispatch:

env:
  APP_NAME: infass
  GCP_REGION: europe-southwest1

jobs:
  trigger-ingestor:
    uses: ./.github/workflows/trigger-cloud-run-job.yml
    with:
      region: ${{ env.GCP_REGION }}
      app_name: ${{ env.APP_NAME }}
      component: ingestor
      args: "https://tienda.mercadona.es,gs://infass-merc/merc"
    secrets:
      gcp_credentials: ${{ secrets.GCP_CICD_CREDENTIALS }}

  trigger-transformer:
    needs: trigger-ingestor
    uses: ./.github/workflows/trigger-cloud-run-job.yml
    with:
      region: ${{ env.GCP_REGION }}
      app_name: ${{ env.APP_NAME }}
      component: transformer-v2
      args: "--gcs-source-bucket,infass-merc,--product,merc,--bq-destination-table,inflation-assistant.infass.incremental_merc"
    secrets:
      gcp_credentials: ${{ secrets.GCP_CICD_CREDENTIALS }}
